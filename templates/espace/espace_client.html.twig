{% extends 'base.html.twig' %}

{% block title %}
	Espace membre | Electro-Multifix
{% endblock %}

{% block body %}

	{% include 'admin/_menu.html.twig' %}


	<div class="container">
		<div class="row my-5">
			<div class="col-12 col-sm-6 col-md-6">
				<div class="card alert alert-danger text-center">
					<div class="row g-0 align-items-center">
						<div class="col-md-4">
							<img src="{{asset('assets/images/icone/service.png')}}" class="img-fluid" width="60px" alt="...">
						</div>
						<div class="col-md-8">
							<div class="card-body">
								<h6 class="card-title">
									{{ commandeCount }}
									Commande passée
								</h6>

							</div>
						</div>
					</div>

				</div>

			</div>


			<div class="col-12 col-sm-6 col-md-6">
				<div class="card alert alert-info text-center">
					<div class="row g-0 align-items-center">
						<div class="col-md-4">
							<img src="{{asset('assets/images/icone/programme.png')}}" class="img-fluid" width="60px" alt="...">
						</div>
						<div class="col-md-8">
							<div class="card-body">
								<h6 class="card-title">
									{{ reparationCount }}
									Réparation Effectuées
								</h6>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="my-3 text-center">
			<h2>Mes Commandes</h2>
		</div>

		{% for type, messages in app.flashes %}
			{% for message in messages %}
				<div class="alert alert-{{ type }} alert-dismissible fade my-2 mx-5 show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}
		{% endfor %}

		<!-- Barre de recherche pour filtrer les commandes -->
		<div class="row mb-4">
			<div class="col">
				<form method="get" action="{{ path('mes_commandes') }}">
					<div class="input-group">
						<select class="form-select" name="status">
							<option value="" selected>Tout afficher</option>
							<option value="0" {% if app.request.query.get('status') == 'en_cours' %} selected {% endif %}>En cours</option>
							<option value="1" {% if app.request.query.get('status') == 'termine' %} selected {% endif %}>Terminé</option>
						</select>
						<button class="btn btn-primary" type="submit">Filtrer</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Liste des commandes avec pagination -->
		<div class="row mb-5">
			<div class="col">
				{% if paginationCommandes is empty %}
					<div class="alert alert-info">
						Aucune commande trouvée.
					</div>

				{% else %}
					<div class="table-responsive">
						<table class="table ">
							<thead class="text-center">
								<tr>
									<th>Numero de la commande</th>
									<th>Date</th>
									<th>Statut</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody class="text-center">
								{% for commande in paginationCommandes %}
									<tr>
										<td>
											{{ commande.matricule }}
										</td>
										<td>{{ commande.createdAt|date('d/m/Y') }}</td>
										<td>
											{% if commande.status %}
												<span class="badge bg-success">Terminé</span>
											{% else %}
												<span class="badge bg-warning">En cours</span>
											{% endif %}
										</td>

										<td>
											<a href="{{path('commande_passer',{'matricule':commande.matricule,'id':commande.id})}}" class="btn btn-info">
												<i class="fas fa-eye"></i>
												Voir la commande
											</a>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>

					<div class="pagination">
						{{ knp_pagination_render(paginationCommandes) }}
					</div>
				{% endif %}
			</div>
		</div>
	</div>


{% endblock %}
